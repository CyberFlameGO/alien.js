<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Alien.js â€” Matcap</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div id="root"></div>
    <script type="module">import{Color,Events,FXAAMaterial,Group,Mesh,MeshMatcapMaterial,OrthographicCamera,PerspectiveCamera,RGBFormat,Scene,SphereGeometry,Stage,TextureLoader,Uniform,Vector2,WebGL1Renderer,WebGLRenderTarget,getFullscreenTriangle,ticker}from"../build/alien.js";class Config{}Config.BG_COLOR="#0e0e0e",Config.UI_COLOR="rgba(255, 255, 255, 0.94)",Config.BREAKPOINT=1e3;import periodic3d from"../src/shaders/modules/noise/periodic3d.glsl.js";const vertexShaderChunk="\n            float f = 0.05 * pnoise(vec3(2.0 * normal + time), vec3(10.0));\n            vec3 transformed = position + f * normal;\n        ";class SceneView extends Group{constructor(){super(),this.initMesh()}async initMesh(){const{loadTexture:e,time:r}=WorldController,t=new SphereGeometry(1,80,80),n=await e("assets/textures/matcaps/040full.jpg"),a=new MeshMatcapMaterial({matcap:n,dithering:!0});a.onBeforeCompile=e=>{e.uniforms.time=r,e.vertexShader="uniform float time;\n"+periodic3d+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",vertexShaderChunk)};const i=new Mesh(t,a);this.add(i)}}class RenderManager{static init(e,r,t){this.renderer=e,this.scene=r,this.camera=t,this.enabled=!0,this.initRenderer()}static initRenderer(){const{resolution:e,screenTriangle:r}=WorldController;this.screenScene=new Scene,this.screenCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.screen=new Mesh(r),this.screen.frustumCulled=!1,this.screenScene.add(this.screen),this.renderTarget=new WebGLRenderTarget(1,1,{format:RGBFormat,anisotropy:0}),this.fxaaMaterial=new FXAAMaterial,this.fxaaMaterial.uniforms.tMap.value=this.renderTarget.texture,this.fxaaMaterial.uniforms.uResolution=e,this.screen.material=this.fxaaMaterial}}RenderManager.resize=(e,r,t)=>{RenderManager.renderer.setPixelRatio(t),RenderManager.renderer.setSize(e,r),e=Math.round(e*t),r=Math.round(r*t),RenderManager.renderTarget.setSize(e,r)},RenderManager.update=()=>{const e=RenderManager.renderer,r=RenderManager.scene,t=RenderManager.camera;if(!RenderManager.enabled)return e.setRenderTarget(null),void e.render(r,t);const n=RenderManager.screenScene,a=RenderManager.screenCamera,i=RenderManager.renderTarget;e.setRenderTarget(i),e.render(r,t),e.setRenderTarget(null),e.render(n,a)};class WorldController{static init(){this.initWorld(),this.initLoaders()}static initWorld(){this.renderer=new WebGL1Renderer({powerPreference:"high-performance",stencil:!1}),this.element=this.renderer.domElement,this.scene=new Scene,this.scene.background=new Color(Config.BG_COLOR),this.camera=new PerspectiveCamera(30),this.camera.near=.5,this.camera.far=50,this.camera.position.z=8,this.screenTriangle=getFullscreenTriangle(),this.resolution=new Uniform(new Vector2),this.aspect=new Uniform(1),this.time=new Uniform(0),this.frame=new Uniform(0)}static initLoaders(){this.textureLoader=new TextureLoader}}WorldController.resize=(e,r,t)=>{WorldController.camera.aspect=e/r,WorldController.camera.updateProjectionMatrix(),e<r?WorldController.camera.position.z=10:e<Config.BREAKPOINT?WorldController.camera.position.z=6:WorldController.camera.position.z=8,e=Math.round(e*t),r=Math.round(r*t),WorldController.resolution.value.set(e,r),WorldController.aspect.value=e/r},WorldController.update=(e,r,t)=>{WorldController.time.value=e,WorldController.frame.value=t},WorldController.getTexture=(e,r)=>WorldController.textureLoader.load(e,r),WorldController.loadTexture=e=>WorldController.textureLoader.loadAsync(e);class App{static async init(){this.initWorld(),this.initViews(),this.initControllers(),this.addListeners(),this.onResize()}static initWorld(){WorldController.init(),Stage.add(WorldController.element)}static initViews(){this.view=new SceneView,WorldController.scene.add(this.view)}static initControllers(){const{renderer:e,scene:r,camera:t}=WorldController;RenderManager.init(e,r,t)}static addListeners(){Stage.events.on(Events.RESIZE,this.onResize),ticker.add(this.onUpdate)}}App.onResize=()=>{const{width:e,height:r,dpr:t}=Stage;WorldController.resize(e,r,t),RenderManager.resize(e,r,t)},App.onUpdate=(e,r,t)=>{WorldController.update(e,r,t),RenderManager.update(e,r,t)},App.init();</script>
</body>
</html>

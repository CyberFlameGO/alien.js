<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Alien.js â€” Shader Hologram</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div id="root"></div>
    <script type="module">import{ACESFilmicToneMapping,AmbientLight,BloomCompositeMaterial,BlurDirectionX,BlurDirectionY,BlurMaterial,BoxGeometry,Color,Device,DirectionalLight,EnvironmentTextureLoader,Events,FXAAMaterial,Group,HemisphereLight,ImageBitmapLoaderThread,LuminosityMaterial,Mesh,MeshBasicMaterial,MeshStandardMaterial,NoBlending,OrbitControls,OrthographicCamera,PerspectiveCamera,RGBFormat,RawShaderMaterial,Scene,SceneCompositeMaterial,SphericalCubeTextureLoader,Stage,TextureLoader,Thread,Uniform,UnrealBloomBlurMaterial,Vector2,VideoGlitchMaterial,WebGL1Renderer,WebGLRenderTarget,getFullscreenTriangle,mix,ticker}from"../build/alien.js";class Config{}Config.BG_COLOR="#0e0e0e",Config.UI_COLOR="rgba(255, 255, 255, 0.94)",Config.LIGHT_COLOR=39423,Config.ERROR_COLOR=16711680;class Layer{}Layer.DEFAULT=0,Layer.HOLOGRAM=1,Layer.OCCLUSION=2;import blendScreen from"../src/shaders/modules/blending/screen.glsl.js";const vertexCompositeShader="\n            attribute vec2 uv;\n            attribute vec3 position;\n\n            varying vec2 vUv;\n\n            void main() {\n                vUv = uv;\n\n                gl_Position = vec4(position, 1.0);\n            }\n        ",fragmentCompositeShader=`\n            precision highp float;\n\n            uniform sampler2D tScene;\n            uniform sampler2D tHologram;\n            uniform sampler2D tOcclusion;\n\n            varying vec2 vUv;\n\n            ${blendScreen}\n\n            void main() {\n                vec4 base = texture2D(tScene, vUv);\n                vec4 blend = texture2D(tHologram, vUv);\n\n                gl_FragColor = blendScreen(base, blend, 1.0);\n\n                base = gl_FragColor;\n                blend = texture2D(tOcclusion, vUv);\n\n                gl_FragColor = blendScreen(base, blend, 1.0);\n            }\n        `;class CompositeMaterial extends RawShaderMaterial{constructor(){super({uniforms:{tScene:new Uniform(null),tHologram:new Uniform(null),tOcclusion:new Uniform(null)},vertexShader:vertexCompositeShader,fragmentShader:fragmentCompositeShader,blending:NoBlending,depthWrite:!1,depthTest:!1})}}class SceneView extends Group{constructor(){super(),this.animateIn=()=>{this.visible=!0},this.ready=async()=>{this.initGeometry(),await this.initEnvironmentTexture(),this.initMesh1(),this.initMesh2(),this.initMesh3()},this.visible=!1}initGeometry(){this.geometry=new BoxGeometry(1,1,1,32,32,32);for(const e in this.geometry.vertices){this.geometry.vertices[e].setLength(1)}this.geometry.computeVertexNormals(),this.geometry.faceVertexUvs[1]=this.geometry.faceVertexUvs[0]}async initEnvironmentTexture(){const{loadEnvironmentTexture:e}=WorldController;this.envMap=await e("assets/textures/env.jpg")}initMesh1(){const{getSphericalCubeTextures:e}=WorldController,r=e("assets/textures/pbr/pitted_metal_basecolor.jpg"),t=e("assets/textures/pbr/pitted_metal_normal.jpg"),a=e("assets/textures/pbr/pitted_metal_orm.jpg"),n=[];for(let e=0;e<6;e++)n[e]=new MeshStandardMaterial({color:new Color(1,1,1),roughness:1,metalness:1,map:r[e],aoMap:a[e],aoMapIntensity:1,roughnessMap:a[e],metalnessMap:a[e],normalMap:t[e],normalScale:new Vector2(1,1),envMap:this.envMap,envMapIntensity:.5,transparent:!0});const i=new Mesh(this.geometry,n);i.position.x=-2.5,i.scale.x=-1;const s=n.map(e=>{const r=e.clone();return r.color=new Color(Config.LIGHT_COLOR),r.emissive=new Color(Config.LIGHT_COLOR),r.emissiveIntensity=.125,r}),o=new Mesh(this.geometry,s);o.position.copy(i.position),o.scale.copy(i.scale),i.layers.set(Layer.HOLOGRAM),o.layers.set(Layer.OCCLUSION),this.add(i),this.add(o)}initMesh2(){const{getSphericalCubeTextures:e}=WorldController,r=e("assets/textures/pbr/pitted_metal_basecolor.jpg"),t=e("assets/textures/pbr/pitted_metal_normal.jpg"),a=e("assets/textures/pbr/pitted_metal_orm.jpg"),n=[];for(let e=0;e<6;e++)n[e]=new MeshStandardMaterial({color:Config.BG_COLOR,roughness:1,metalness:1,map:r[e],aoMap:a[e],aoMapIntensity:1,roughnessMap:a[e],metalnessMap:a[e],normalMap:t[e],normalScale:new Vector2(1,1),envMap:this.envMap,envMapIntensity:.5,transparent:!0});const i=new Mesh(this.geometry,n);i.scale.x=-1,this.add(i)}initMesh3(){const{getSphericalCubeTextures:e}=WorldController,r=e("assets/textures/pbr/polished_concrete_basecolor.jpg"),t=e("assets/textures/pbr/polished_concrete_normal.jpg"),a=e("assets/textures/pbr/polished_concrete_orm.jpg"),n=[];for(let e=0;e<6;e++)n[e]=new MeshStandardMaterial({color:new Color(1,1,1),roughness:1,metalness:1,map:r[e],aoMap:a[e],aoMapIntensity:1,roughnessMap:a[e],metalnessMap:a[e],normalMap:t[e],normalScale:new Vector2(1,1),envMap:this.envMap,envMapIntensity:.5,transparent:!0});const i=new Mesh(this.geometry,n);i.position.x=2.5,i.scale.x=-1;const s=n.map(e=>{const r=e.clone();return r.color=new Color(Config.ERROR_COLOR),r.emissive=new Color(Config.ERROR_COLOR),r.emissiveIntensity=.125,r}),o=new Mesh(this.geometry,s);o.position.copy(i.position),o.scale.copy(i.scale),i.layers.set(Layer.HOLOGRAM),o.layers.set(Layer.OCCLUSION),this.add(i),this.add(o)}}class RenderManager{static init(e,r,t){this.renderer=e,this.scene=r,this.camera=t,this.blurResolutionScale=.25,this.blurFactor=7,this.luminosityThreshold=.1,this.bloomStrength=.3,this.bloomRadius=.75,this.enabled=!0,this.initRenderer()}static initRenderer(){const{resolution:e,screenTriangle:r,time:t}=WorldController;this.renderer.autoClear=!1,this.screenScene=new Scene,this.screenCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.screen=new Mesh(r),this.screen.frustumCulled=!1,this.screenScene.add(this.screen),this.renderTargetA=new WebGLRenderTarget(1,1,{format:RGBFormat,anisotropy:0,depthBuffer:!1}),this.renderTargetB=this.renderTargetA.clone(),this.renderTargetC=this.renderTargetA.clone(),this.renderTargetHologram=this.renderTargetA.clone(),this.renderTargetBlurA=this.renderTargetA.clone(),this.renderTargetBlurB=this.renderTargetA.clone(),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5,this.renderTargetBright=this.renderTargetA.clone();for(let e=0,r=this.nMips;e<r;e++)this.renderTargetsHorizontal.push(this.renderTargetA.clone()),this.renderTargetsVertical.push(this.renderTargetA.clone());this.renderTargetA.depthBuffer=!0,this.renderTargetHologram.depthBuffer=!0,this.renderTargetBlurA.depthBuffer=!0,this.backgroundScene=new Scene,this.backgroundScene.background=new Color(Config.BG_COLOR),this.videoGlitchMaterial=new VideoGlitchMaterial,this.videoGlitchMaterial.uniforms.uTime=t,this.blackoutMaterial=new MeshBasicMaterial({color:0}),this.fxaaMaterial=new FXAAMaterial,this.fxaaMaterial.uniforms.uResolution=e,this.luminosityMaterial=new LuminosityMaterial,this.luminosityMaterial.uniforms.uLuminosityThreshold.value=this.luminosityThreshold,this.hBlurMaterial=new BlurMaterial(BlurDirectionX),this.hBlurMaterial.uniforms.uBluriness.value=this.blurFactor,this.hBlurMaterial.uniforms.uResolution=e,this.vBlurMaterial=new BlurMaterial(BlurDirectionY),this.vBlurMaterial.uniforms.uBluriness.value=this.blurFactor,this.vBlurMaterial.uniforms.uResolution=e,this.blurMaterials=[];const a=[3,5,7,9,11];for(let e=0,r=this.nMips;e<r;e++)this.blurMaterials.push(new UnrealBloomBlurMaterial(a[e])),this.blurMaterials[e].uniforms.uResolution.value=new Vector2;const n=[1,.8,.6,.4,.2];for(let e=0,r=this.nMips;e<r;e++){const r=n[e];n[e]=this.bloomStrength*mix(r,1.2-r,this.bloomRadius)}this.bloomCompositeMaterial=new BloomCompositeMaterial(this.nMips),this.bloomCompositeMaterial.uniforms.tBlur1.value=this.renderTargetsVertical[0].texture,this.bloomCompositeMaterial.uniforms.tBlur2.value=this.renderTargetsVertical[1].texture,this.bloomCompositeMaterial.uniforms.tBlur3.value=this.renderTargetsVertical[2].texture,this.bloomCompositeMaterial.uniforms.tBlur4.value=this.renderTargetsVertical[3].texture,this.bloomCompositeMaterial.uniforms.tBlur5.value=this.renderTargetsVertical[4].texture,this.bloomCompositeMaterial.uniforms.uBloomFactors.value=n,this.sceneCompositeMaterial=new CompositeMaterial,this.compositeMaterial=new SceneCompositeMaterial}}RenderManager.resize=(e,r,t)=>{RenderManager.renderer.setPixelRatio(t),RenderManager.renderer.setSize(e,r),e=Math.round(e*t),r=Math.round(r*t),RenderManager.renderTargetA.setSize(e,r),RenderManager.renderTargetB.setSize(e,r),RenderManager.renderTargetC.setSize(e,r),RenderManager.renderTargetHologram.setSize(e,r);const a=Math.round(e*RenderManager.blurResolutionScale),n=Math.round(r*RenderManager.blurResolutionScale);RenderManager.renderTargetBlurA.setSize(a,n),RenderManager.renderTargetBlurB.setSize(a,n),e=Math.round(e/2),r=Math.round(r/2),RenderManager.renderTargetBright.setSize(e,r);for(let t=0,a=RenderManager.nMips;t<a;t++)RenderManager.renderTargetsHorizontal[t].setSize(e,r),RenderManager.renderTargetsVertical[t].setSize(e,r),RenderManager.blurMaterials[t].uniforms.uResolution.value.set(e,r),e=Math.round(e/2),r=Math.round(r/2)},RenderManager.update=()=>{const e=RenderManager.renderer,r=RenderManager.scene,t=RenderManager.camera;if(!RenderManager.enabled)return e.setRenderTarget(null),e.clear(),void e.render(r,t);const a=RenderManager.screenScene,n=RenderManager.screenCamera,i=RenderManager.renderTargetA,s=RenderManager.renderTargetB,o=RenderManager.renderTargetC,l=RenderManager.renderTargetHologram,d=RenderManager.renderTargetBlurA,c=RenderManager.renderTargetBlurB,h=RenderManager.renderTargetBright,u=RenderManager.renderTargetsHorizontal,g=RenderManager.renderTargetsVertical,M=r.overrideMaterial;t.layers.set(Layer.DEFAULT),e.setRenderTarget(i),e.clear(),e.render(RenderManager.backgroundScene,t),e.setRenderTarget(i),e.render(r,t),r.overrideMaterial=RenderManager.blackoutMaterial,e.setRenderTarget(l),e.clear(),e.render(r,t),r.overrideMaterial=M,t.layers.set(Layer.HOLOGRAM),e.render(r,t),RenderManager.videoGlitchMaterial.uniforms.tMap.value=l.texture,RenderManager.screen.material=RenderManager.videoGlitchMaterial,e.setRenderTarget(s),e.clear(),e.render(a,n),t.layers.set(Layer.DEFAULT),r.overrideMaterial=RenderManager.blackoutMaterial,e.setRenderTarget(d),e.clear(),e.render(r,t),r.overrideMaterial=M,t.layers.set(Layer.OCCLUSION),e.render(r,t),RenderManager.hBlurMaterial.uniforms.tMap.value=d.texture,RenderManager.screen.material=RenderManager.hBlurMaterial,e.setRenderTarget(c),e.clear(),e.render(a,n),RenderManager.vBlurMaterial.uniforms.tMap.value=c.texture,RenderManager.screen.material=RenderManager.vBlurMaterial,e.setRenderTarget(d),e.clear(),e.render(a,n),RenderManager.videoGlitchMaterial.uniforms.tMap.value=d.texture,RenderManager.screen.material=RenderManager.videoGlitchMaterial,e.setRenderTarget(c),e.clear(),e.render(a,n),RenderManager.sceneCompositeMaterial.uniforms.tScene.value=i.texture,RenderManager.sceneCompositeMaterial.uniforms.tHologram.value=s.texture,RenderManager.sceneCompositeMaterial.uniforms.tOcclusion.value=c.texture,RenderManager.screen.material=RenderManager.sceneCompositeMaterial,e.setRenderTarget(o),e.clear(),e.render(a,n),t.layers.set(Layer.DEFAULT),RenderManager.fxaaMaterial.uniforms.tMap.value=o.texture,RenderManager.screen.material=RenderManager.fxaaMaterial,e.setRenderTarget(i),e.clear(),e.render(a,n),RenderManager.luminosityMaterial.uniforms.tMap.value=i.texture,RenderManager.screen.material=RenderManager.luminosityMaterial,e.setRenderTarget(h),e.clear(),e.render(a,n);let m=h;for(let r=0,t=RenderManager.nMips;r<t;r++)RenderManager.screen.material=RenderManager.blurMaterials[r],RenderManager.blurMaterials[r].uniforms.tMap.value=m.texture,RenderManager.blurMaterials[r].uniforms.uDirection.value=BlurDirectionX,e.setRenderTarget(u[r]),e.clear(),e.render(a,n),RenderManager.blurMaterials[r].uniforms.tMap.value=RenderManager.renderTargetsHorizontal[r].texture,RenderManager.blurMaterials[r].uniforms.uDirection.value=BlurDirectionY,e.setRenderTarget(g[r]),e.clear(),e.render(a,n),m=g[r];RenderManager.screen.material=RenderManager.bloomCompositeMaterial,e.setRenderTarget(u[0]),e.clear(),e.render(a,n),RenderManager.compositeMaterial.uniforms.tScene.value=i.texture,RenderManager.compositeMaterial.uniforms.tBloom.value=u[0].texture,RenderManager.screen.material=RenderManager.compositeMaterial,e.setRenderTarget(null),e.clear(),e.render(a,n)};class WorldController{static init(){this.initWorld(),this.initLights(),this.initLoaders(),this.initControls()}static initWorld(){this.renderer=new WebGL1Renderer({powerPreference:"high-performance",stencil:!1}),this.element=this.renderer.domElement,this.renderer.toneMapping=ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.scene=new Scene,this.camera=new PerspectiveCamera(30),this.camera.near=.5,this.camera.far=50,this.camera.position.z=6,this.screenTriangle=getFullscreenTriangle(),this.resolution=new Uniform(new Vector2),this.aspect=new Uniform(1),this.time=new Uniform(0),this.frame=new Uniform(0)}static initLights(){const e=new AmbientLight(16777215,.2),r=new HemisphereLight(6316128,4210752),t=new DirectionalLight(16777215,.4);t.position.set(.6,.5,1),this.scene.add(e),this.scene.add(r),this.scene.add(t),e.layers.enable(Layer.HOLOGRAM),r.layers.enable(Layer.HOLOGRAM),t.layers.enable(Layer.HOLOGRAM),e.layers.enable(Layer.OCCLUSION),r.layers.enable(Layer.OCCLUSION),t.layers.enable(Layer.OCCLUSION)}static initLoaders(){this.textureLoader=new TextureLoader,this.spherizeLoader=new SphericalCubeTextureLoader(this.renderer,!0),this.spherizeLoader.setOptions({size:512}),this.environmentLoader=new EnvironmentTextureLoader(this.renderer)}static initControls(){this.controls=new OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.enableZoom=!1}}WorldController.resize=(e,r,t)=>{WorldController.camera.aspect=e/r,WorldController.camera.updateProjectionMatrix(),e=Math.round(e*t),r=Math.round(r*t),WorldController.resolution.value.set(e,r),WorldController.aspect.value=e/r,WorldController.camera.position.z=e<r?10:6},WorldController.update=(e,r,t)=>{WorldController.time.value=e,WorldController.frame.value=t,WorldController.controls.update()},WorldController.getTexture=e=>WorldController.textureLoader.load(e),WorldController.getSphericalCubeTextures=e=>WorldController.spherizeLoader.load(e),WorldController.loadEnvironmentTexture=e=>WorldController.environmentLoader.loadAsync(e);class App{static async init(){Device.agent.includes("chrome")&&this.initThread(),this.initWorld(),this.initViews(),this.initControllers(),this.addListeners(),this.onResize(),await this.view.ready(),this.view.animateIn()}static initThread(){ImageBitmapLoaderThread.init(),Thread.shared()}static initWorld(){WorldController.init(),Stage.add(WorldController.element)}static initViews(){this.view=new SceneView,WorldController.scene.add(this.view)}static initControllers(){const{renderer:e,scene:r,camera:t}=WorldController;RenderManager.init(e,r,t)}static addListeners(){Stage.events.on(Events.RESIZE,this.onResize),ticker.add(this.onUpdate)}}App.onResize=()=>{const{width:e,height:r,dpr:t}=Stage;WorldController.resize(e,r,t),RenderManager.resize(e,r,t)},App.onUpdate=(e,r,t)=>{WorldController.update(e,r,t),RenderManager.update(e,r,t)},App.init();</script>
</body>
</html>
